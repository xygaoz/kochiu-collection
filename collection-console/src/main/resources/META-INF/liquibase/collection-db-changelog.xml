<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.19.xsd">

    <changeSet author="kochiu" id="kcdb_1" runOnChange="true" dbms="sqlite">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_role"/>
            </not>
        </preConditions>
        <createTable remarks="系统角色表" tableName="sys_role">
            <column name="ROLE_ID" remarks="主键" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ROLE_NAME" remarks="角色名称" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="CAN_DEL" remarks="能否删除" type="INTEGER" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_role"
                columnName="ROLE_ID"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_2" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists tableName="sys_role" indexName="IDX_ROLE_NAME"/>
            </not>
        </preConditions>
        <createIndex tableName="sys_role" indexName="IDX_ROLE_NAME" unique="true">
            <column name="ROLE_NAME"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_3" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM sys_role
                WHERE role_id = 1
            </sqlCheck>
        </preConditions>
        <insert tableName="sys_role">
            <column name="ROLE_ID" value="1"/>
            <column name="ROLE_NAME" value="超级管理员"/>
            <column name="CAN_DEL" value="0"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet author="kochiu" id="kcdb_4" runOnChange="true" dbms="sqlite">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_user"/>
            </not>
        </preConditions>
        <createTable remarks="系统用户表" tableName="sys_user">
            <column name="USER_ID" remarks="主键" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="USER_CODE" remarks="用户编码" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="PASSWORD" remarks="密码" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="USER_NAME" remarks="用户名称" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="status" remarks="状态" type="INTEGER" defaultValue="1"/>
            <column name="TOKEN" remarks="token" type="VARCHAR(200)"/>
            <column name="KEY" remarks="加密key" type="VARCHAR(100)"/>
            <column name="Strategy" remarks="存储策略" type="VARCHAR(10)" defaultValue="local">
                <constraints nullable="false"/>
            </column>
            <column name="CAN_DEL" remarks="能否删除" type="INTEGER" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="last_token_time" remarks="最后刷新token时间" type="datetime"/>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_user"
                columnName="USER_ID"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_5" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists tableName="sys_user" indexName="IDX_USER_CODE"/>
            </not>
        </preConditions>
        <createIndex tableName="sys_user" indexName="IDX_USER_CODE" unique="true">
            <column name="USER_CODE"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_6" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM sys_user
                WHERE user_id = 1
            </sqlCheck>
        </preConditions>
        <customChange class="com.kochiu.collection.service.db.SysUserValueChange">
            <param name="tableName" value="sys_user"/>
        </customChange>
    </changeSet>

    <changeSet author="kochiu" id="kcdb_7" runOnChange="true" dbms="sqlite">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_security"/>
            </not>
        </preConditions>
        <createTable remarks="系统密钥表" tableName="sys_security">
            <column name="ID" remarks="主键" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="PUBLIC_KEY" remarks="公钥" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="PRIVATE_KEY" remarks="私钥" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="COMMON_KEY" remarks="公用加密key" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_security"
                columnName="ID"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_8" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="sys_security"/>
        </preConditions>
        <customChange class="com.kochiu.collection.service.db.SysSecurityValueChange">
            <param name="tableName" value="sys_security"/>
        </customChange>
    </changeSet>

    <changeSet id="kcdb_9" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_category"/>
            </not>
        </preConditions>
        <createTable remarks="用户资源分类表" tableName="user_category">
            <column name="CATE_ID" remarks="主键" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="CATE_NAME" remarks="分类名称" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" remarks="用户ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="SNO" remarks="序号" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_category"
                columnName="CATE_ID"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_10" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="user_category"/>
        </preConditions>
        <insert tableName="user_category">
            <column name="CATE_ID" value="1"/>
            <column name="CATE_NAME" value="默认"/>
            <column name="USER_ID" value="1"/>
            <column name="SNO" value="1"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="kcdb_11" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_resource"/>
            </not>
        </preConditions>
        <createTable remarks="用户资源表" tableName="user_resource">
            <column name="RESOURCE_ID" remarks="主键" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" remarks="用户ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="title" remarks="标题" type="VARCHAR(100)"/>
            <column name="description" remarks="描述" type="VARCHAR(500)"/>
            <column name="SOURCE_FILE_NAME" remarks="原文件名" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="FILE_PATH" remarks="存储路径" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="SAVE_TYPE" remarks="存储类型" type="integer" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="RESOURCE_URL" remarks="资源url" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="thumb_url" remarks="缩略图路径" type="VARCHAR(200)"/>
            <column name="preview_url" remarks="预览路径" type="VARCHAR(200)"/>
            <column name="deleted" remarks="是否删除" type="INTEGER" defaultValue="0"/>
            <column name="CATE_ID" remarks="分类ID" type="INTEGER" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="cata_id" remarks="目录ID" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="resource_type" remarks="资源类型" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="file_ext" remarks="文件扩展名" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="resolution_ratio" remarks="原图分辨率" type="VARCHAR(100)"/>
            <column name="thumb_ratio" remarks="缩略图分辨率" type="VARCHAR(100)"/>
            <column name="size" remarks="文件大小" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="share" remarks="共享" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="star" remarks="星级" type="INTEGER" defaultValue="0"/>
            <column name="md5" remarks="文件md5值" type="VARCHAR(32)"/>
            <column name="DELETE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_resource"
                columnName="RESOURCE_ID"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_12" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_resource_index1" tableName="user_resource"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_resource_index1"
                tableName="user_resource">
            <column name="USER_ID"/>
            <column name="md5"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_13" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_resource_index2" tableName="user_resource"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_resource_index2"
                tableName="user_resource">
            <column name="USER_ID"/>
            <column name="CATE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_14" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_resource_index3" tableName="user_resource"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_resource_index3"
                tableName="user_resource">
            <column name="USER_ID"/>
            <column name="title"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_15" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_resource_tag"/>
            </not>
        </preConditions>
        <createTable remarks="用户资源标签表" tableName="user_resource_tag">
            <column name="res_tag_id" type="INTEGER" remarks="标签id">
                <constraints nullable="false"/>
            </column>
            <column name="RESOURCE_ID" remarks="资源ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" remarks="用户ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="TAG_ID" remarks="标签ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_resource_tag"
                columnName="res_tag_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_16" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_tag"/>
            </not>
        </preConditions>
        <createTable remarks="用户标签表" tableName="user_tag">
            <column name="tag_id" type="INTEGER" remarks="标签id">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" remarks="用户ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="tag_name" remarks="标签" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_tag"
                columnName="tag_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_17" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_tag_idx1" tableName="user_tag"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_tag_idx1"
                tableName="user_tag" unique="true">
            <column name="USER_ID"/>
            <column name="tag_name"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_18" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_config"/>
            </not>
        </preConditions>
        <createTable remarks="系统配置表" tableName="sys_config">
            <column name="config_id" type="INTEGER" remarks="配置id">
                <constraints nullable="false"/>
            </column>
            <column name="config_key" remarks="配置key" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="config_value" remarks="配置值" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="config_desc" remarks="配置描述" type="VARCHAR(100)"/>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_config"
                columnName="config_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_19" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_catalog"/>
            </not>
        </preConditions>
        <createTable remarks="用户目录表" tableName="user_catalog">
            <column name="cata_id" type="INTEGER" remarks="目录id">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" remarks="用户ID" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" remarks="上级目录" type="INTEGER"/>
            <column name="cata_name" remarks="目录名" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="cata_path" remarks="目录路径" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="cata_level" remarks="目录层次" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="cata_sno" remarks="目录序号" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_catalog"
                columnName="cata_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_20" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_catalog_idx1" tableName="user_catalog"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_catalog_idx1"
                tableName="user_catalog" unique="true">
            <column name="USER_ID"/>
            <column name="cata_path"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_21" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_catalog_idx2" tableName="user_catalog"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_catalog_idx2"
                tableName="user_catalog" unique="true">
            <column name="USER_ID"/>
            <column name="cata_sno"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_22" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="user_catalog"/>
        </preConditions>
        <insert tableName="user_catalog">
            <column name="cata_id" value="1"/>
            <column name="USER_ID" value="1"/>
            <column name="cata_name" value="我的资源"/>
            <column name="cata_path" value="/"/>
            <column name="cata_level" value="0"/>
            <column name="cata_sno" value="1"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="kcdb_23" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_catalog_idx3" tableName="user_catalog"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_catalog_idx3"
                tableName="user_catalog">
            <column name="USER_ID"/>
            <column name="parent_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_24" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_strategy"/>
            </not>
        </preConditions>
        <createTable remarks="资源存储策略表" tableName="sys_strategy">
            <column name="strategy_id" type="INTEGER" remarks="策略id">
                <constraints nullable="false"/>
            </column>
            <column name="strategy_code" type="VARCHAR(20)" remarks="策略编号">
                <constraints nullable="false"/>
            </column>
            <column name="strategy_name" type="VARCHAR(200)" remarks="策略名称">
                <constraints nullable="false"/>
            </column>
            <column name="server_url" type="VARCHAR(300)" remarks="保存地址/服务网址">
                <constraints nullable="false"/>
            </column>
            <column name="username" type="varchar(20)" remarks="访问账号"/>
            <column name="password" type="varchar(20)" remarks="访问密码"/>
            <column name="other_config" remarks="其他配置（json格式）" type="VARCHAR(500)"/>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_strategy"
                columnName="strategy_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_25" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="sys_strategy_idx1" tableName="sys_strategy"/>
            </not>
        </preConditions>
        <createIndex
                indexName="sys_strategy_idx1"
                tableName="sys_strategy" unique="true">
            <column name="strategy_code"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_26" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="sys_strategy"/>
        </preConditions>
        <customChange class="com.kochiu.collection.service.db.SysStrategyValueChange">
            <param name="tableName" value="sys_strategy"/>
        </customChange>
    </changeSet>

    <changeSet id="kcdb_27" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_role"/>
            </not>
        </preConditions>
        <createTable remarks="用户角色表" tableName="user_role">
            <column name="user_role_id" type="INTEGER" remarks="id">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="INTEGER" remarks="角色ID">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="INTEGER" remarks="用户ID">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_role"
                columnName="user_role_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_28" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_role_idx1" tableName="user_role"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_role_idx1"
                tableName="user_role" unique="true">
            <column name="role_id"/>
            <column name="user_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_29" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="user_role"/>
        </preConditions>
        <insert tableName="user_role">
            <column name="user_role_id" value="1"/>
            <column name="role_id" value="1"/>
            <column name="user_id" value="1"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="kcdb_30" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_module"/>
            </not>
        </preConditions>
        <createTable remarks="系统模块表" tableName="sys_module">
            <column name="module_id" type="INTEGER" remarks="id">
                <constraints nullable="false"/>
            </column>
            <column name="module_code" type="VARCHAR(20)" remarks="模块编码">
                <constraints nullable="false"/>
            </column>
            <column name="module_name" type="VARCHAR(20)" remarks="模块名称">
                <constraints nullable="false"/>
            </column>
            <column name="module_url" type="VARCHAR(200)" remarks="模块url">
                <constraints nullable="false"/>
            </column>
            <column name="redirect" type="VARCHAR(200)" remarks="重定向地址"/>
            <column name="parent_id" type="INTEGER" remarks="父模块ID"/>
            <column name="icon" type="VARCHAR(20)" remarks="模块图标"/>
            <column name="icon_type" type="VARCHAR(30)" remarks="图标类型"/>
            <column name="sort" type="INTEGER" remarks="模块排序"/>
            <column name="style" type="VARCHAR(100)" remarks="图标风格"/>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_module"
                columnName="module_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_31" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="sys_module_idx1" tableName="sys_module"/>
            </not>
        </preConditions>
        <createIndex
                indexName="sys_module_idx1"
                tableName="sys_module" unique="true">
            <column name="module_code"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_32" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="sys_module"/>
        </preConditions>
        <insert tableName="sys_module">
            <column name="module_id" value="1"/>
            <column name="module_code" value="system"/>
            <column name="module_name" value="系统管理"/>
            <column name="module_url" value="/System"/>
            <column name="parent_id" value="0"/>
            <column name="icon" value="icon-col-shezhi"/>
            <column name="icon_type" value="iconfont"/>
            <column name="sort" value="1"/>
            <column name="style" value="font-size: 21px; color: rgb(59,130,246)"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module">
            <column name="module_id" value="2"/>
            <column name="module_code" value="user"/>
            <column name="module_name" value="用户管理"/>
            <column name="module_url" value="/System/User"/>
            <column name="redirect" value="@/components/sys/UserView.vue"/>
            <column name="parent_id" value="1"/>
            <column name="icon" value="UserFilled"/>
            <column name="icon_type" value="icons-vue"/>
            <column name="sort" value="1"/>
            <column name="style" value="color: rgb(59,130,246);"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module">
            <column name="module_id" value="3"/>
            <column name="module_code" value="role"/>
            <column name="module_name" value="角色管理"/>
            <column name="module_url" value="/System/Role"/>
            <column name="redirect" value="@/components/sys/RoleView.vue"/>
            <column name="parent_id" value="1"/>
            <column name="icon" value="icon-col-jiaoseguanli1"/>
            <column name="icon_type" value="iconfont"/>
            <column name="sort" value="2"/>
            <column name="style" value="font-size: 21px; color: rgb(59,130,246)"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module">
            <column name="module_id" value="4"/>
            <column name="module_code" value="strategy"/>
            <column name="module_name" value="存储策略"/>
            <column name="module_url" value="/System/Strategy"/>
            <column name="redirect" value="@/components/sys/StrategyView.vue"/>
            <column name="parent_id" value="1"/>
            <column name="icon" value="icon-col-cunchucelve"/>
            <column name="icon_type" value="iconfont"/>
            <column name="sort" value="3"/>
            <column name="style" value="font-size: 21px; color: rgb(59,130,246)"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module">
            <column name="module_id" value="5"/>
            <column name="module_code" value="config"/>
            <column name="module_name" value="系统配置"/>
            <column name="module_url" value="/System/Config"/>
            <column name="redirect" value="@/components/sys/ConfigView.vue"/>
            <column name="parent_id" value="1"/>
            <column name="icon" value="icon-col-ceshi"/>
            <column name="icon_type" value="iconfont"/>
            <column name="sort" value="3"/>
            <column name="style" value="font-size: 18px; color: rgb(59,130,246)"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="kcdb_33" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sys_module_action"/>
            </not>
        </preConditions>
        <createTable remarks="系统模块动作表" tableName="sys_module_action">
            <column name="action_id" type="INTEGER" remarks="id">
                <constraints nullable="false"/>
            </column>
            <column name="module_id" type="INTEGER" remarks="模块ID">
                <constraints nullable="false"/>
            </column>
            <column name="action_code" type="VARCHAR(20)" remarks="动作编码">
                <constraints nullable="false"/>
            </column>
            <column name="action_name" type="VARCHAR(20)" remarks="动作名称">
                <constraints nullable="false"/>
            </column>
            <column name="action_url" type="VARCHAR(200)" remarks="动作url">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="sys_module_action"
                columnName="action_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_34" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="sys_module_action_idx1" tableName="sys_module_action"/>
            </not>
        </preConditions>
        <createIndex
                indexName="sys_module_action_idx1"
                tableName="sys_module_action" unique="true">
            <column name="module_id"/>
            <column name="action_code"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_35" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="sys_module_action"/>
        </preConditions>
        <insert tableName="sys_module_action">
            <column name="action_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_code" value="add"/>
            <column name="action_name" value="新增"/>
            <column name="action_url" value="/api/v1/user/add"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="2"/>
            <column name="module_id" value="2"/>
            <column name="action_code" value="edit"/>
            <column name="action_name" value="修改"/>
            <column name="action_url" value="/api/v1/user/update"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="3"/>
            <column name="module_id" value="2"/>
            <column name="action_code" value="delete"/>
            <column name="action_name" value="删除"/>
            <column name="action_url" value="/api/v1/user/delete"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="4"/>
            <column name="module_id" value="2"/>
            <column name="action_code" value="reset-pwd"/>
            <column name="action_name" value="重置密码"/>
            <column name="action_url" value="/api/v1/user/resetpwd"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="5"/>
            <column name="module_id" value="2"/>
            <column name="action_code" value="enable-disable"/>
            <column name="action_name" value="停用/启用"/>
            <column name="action_url" value="/api/v1/user/enable-disable"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="6"/>
            <column name="module_id" value="3"/>
            <column name="action_code" value="add"/>
            <column name="action_name" value="新增"/>
            <column name="action_url" value="/api/v1/role/add"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="7"/>
            <column name="module_id" value="3"/>
            <column name="action_code" value="edit"/>
            <column name="action_name" value="修改"/>
            <column name="action_url" value="/api/v1/role/update"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="8"/>
            <column name="module_id" value="3"/>
            <column name="action_code" value="delete"/>
            <column name="action_name" value="删除"/>
            <column name="action_url" value="/api/v1/role/delete"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="9"/>
            <column name="module_id" value="4"/>
            <column name="action_code" value="update"/>
            <column name="action_name" value="保存"/>
            <column name="action_url" value="/api/v1/sys/strategy/update"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="10"/>
            <column name="module_id" value="5"/>
            <column name="action_code" value="clear"/>
            <column name="action_name" value="清空"/>
            <column name="action_url" value="/api/v1/sys/test/clear"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="11"/>
            <column name="module_id" value="5"/>
            <column name="action_code" value="reset-rsa-keys"/>
            <column name="action_name" value="重置rsa密钥"/>
            <column name="action_url" value="/api/v1/sys/reset-rsa-keys"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="sys_module_action">
            <column name="action_id" value="12"/>
            <column name="module_id" value="5"/>
            <column name="action_code" value="reset-key"/>
            <column name="action_name" value="重置公共密钥"/>
            <column name="action_url" value="/api/v1/sys/reset-key"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="kcdb_36" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_permission"/>
            </not>
        </preConditions>
        <createTable remarks="用户权限表" tableName="user_permission">
            <column name="permission_id" type="INTEGER" remarks="id">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="INTEGER" remarks="角色ID">
                <constraints nullable="false"/>
            </column>
            <column name="module_id" type="INTEGER" remarks="模块ID">
                <constraints nullable="false"/>
            </column>
            <column name="action_id" type="INTEGER" remarks="动作ID">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" remarks="创建时间" type="date"/>
            <column name="CREATE_BY" remarks="创建人" type="VARCHAR(20)"/>
            <column name="UPDATE_TIME" remarks="更新时间" type="date"/>
            <column name="UPDATE_BY" remarks="更新人" type="VARCHAR(20)"/>
            <column name="DB_VERSION" remarks="数据版本" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- 添加主键自增元数据 -->
        <addAutoIncrement
                tableName="user_permission"
                columnName="permission_id"
                columnDataType="INTEGER"
        />
    </changeSet>

    <changeSet id="kcdb_37" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_permission_idx1" tableName="user_permission"/>
            </not>
        </preConditions>
        <createIndex
                indexName="user_permission_idx1"
                tableName="user_permission" unique="true">
            <column name="role_id"/>
            <column name="module_id"/>
            <column name="action_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="kcdb_38" author="kochiu" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <rowCount expectedRows="0" tableName="user_permission"/>
        </preConditions>
        <insert tableName="user_permission">
            <column name="permission_id" value="1"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_id" value="1"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="2"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_id" value="2"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="3"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_id" value="3"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="4"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_id" value="4"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="5"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="2"/>
            <column name="action_id" value="5"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="6"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="3"/>
            <column name="action_id" value="6"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="7"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="3"/>
            <column name="action_id" value="7"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="8"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="3"/>
            <column name="action_id" value="8"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="9"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="4"/>
            <column name="action_id" value="9"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="10"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="5"/>
            <column name="action_id" value="10"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="11"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="5"/>
            <column name="action_id" value="11"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
        <insert tableName="user_permission">
            <column name="permission_id" value="12"/>
            <column name="role_id" value="1"/>
            <column name="module_id" value="5"/>
            <column name="action_id" value="12"/>
            <column name="CREATE_TIME" valueComputed="datetime('now')"/>
            <column name="CREATE_BY" value="sys"/>
            <column name="DB_VERSION" value="1"/>
        </insert>
    </changeSet>

</databaseChangeLog>
